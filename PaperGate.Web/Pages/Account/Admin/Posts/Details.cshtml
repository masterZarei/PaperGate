@page
@model PaperGate.Web.Pages.Account.Admin.Posts.DetailsModel
@{
    ViewData["Title"] = "جزئیات مقاله";
}
<div class="container py-8">
    <ul class="breadcrumb">
        <li><a class="hover:text-blue-600 transition" href="~/">خانه</a> <span class="text-gray-500">/</span></li>
        <li><a class="hover:text-blue-600 transition" href="~/Account/Admin/Categories">پنل</a> <span class="text-gray-500">/</span></li>
        <li><a class="hover:text-blue-600 transition" href="~/Account/Admin/Posts">مقاله</a> <span class="text-gray-500">/</span></li>
        <li><a class="hover:text-blue-600 transition" href="#">جزئیات</a></li>
    </ul>
    <div class="block tablet:flex justify-between">
        @await Component.InvokeAsync("SidePanelComponent")
        <div class="w-full tablet:w-9/12 px-3 mt-5">
            <div class="PanelCard border rounded p-3">
                <!--                تایتل-->
                <div class="PanelCard-header">
                    <h2 class="text-lg">جزئیات مقاله</h2>
                </div>
                <div class="PanelCard-body pt-5">
                    <div class="block tablet:flex justify-between">
                        <div class="w-full tablet:w-1/2 px-2">
                            <!--                                نام-->
                            <div class="flex flex-col mt-3">
                                <label for="name" class="customLabel">نام مقاله</label>
                                <input type="text" asp-for="PostDto.Title" id="name" class="customInput disabled:bg-gray-100" disabled>
                            </div>
                            <!--                               تاریخ ایجاد-->
                            <div class="flex flex-col mt-3">
                                <label for="date" class="customLabel">تاریخ ایجاد مقاله</label>
                                <input type="text" value="@Model.PostDto.CreatedOn.ToShamsi(true)" id="date" class="customInput disabled:bg-gray-100" disabled>
                            </div>
                            <!--کلید واژه ها-->
                            <div class="flex flex-col mt-3">
                                <label for="keyword" class="customLabel">کلمات کلیدی</label>
                                <div class="flex flex-wrap mt-4 gap-2">
                                    @if (Model.PostDto.PostKeywords.Any())
                                    {
                                        @foreach (var item in Model.PostDto.PostKeywords)
                                        {
                                            <button class="btnSolid">
                                                @item?.Keyword?.Title
                                            </button>
                                        }
                                    }
                                    else
                                    {
                                        <label>کلمه کلیدی ای موجود نیست</label>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="w-full tablet:w-1/2 px-2">
                            
                        <!--    دسته بندی-->
                            @* <div class="flex flex-col mt-3">
                                <label for="category" class="customLabel">دسته بندی</label>
                                <div class="flex flex-wrap mt-4 gap-2">
                                    @if (Model.PaperDto.PaperCategories.Any())
                                    {
                                        @foreach (var item in Model.PaperDto.PaperCategories)
                                        {
                                            <button class="btnSolid">
                                                @item?.Category?.Title
                                            </button>
                                        }
                                    }
                                    else
                                    {
                                        <label>دسته بندی ای موجود نیست</label>
                                    }
                                </div>
                            </div> *@
                            <!--    دمو عکس-->
                            <div>
                                <img src="~/Assets/Pictures/Papers/@Model?.PostDto?.Picture" class="border border-black w-72 h-52 mx-auto px-2 mt-8" alt="Paper">
                            </div>
                        </div>
                    </div>
                    <div class="w-full">
                    <!--         خلاصه کوتاه-->
                    <div class="w-full flex flex-col px-2 mt-3">
                        <label for="demo" class="customLabel">خلاصه </label>
                        <textarea id="demo" asp-for="PostDto.Summary" cols="30" rows="10" class="customInput disabled:bg-gray-100" disabled></textarea>
                    </div>
                        <!--       متن مقاله-->
                        <div class="w-full flex flex-col px-2 mt-3">
                            <label for="Paper" class="customLabel">مقاله : </label>
                            <textarea asp-for="PostDto.Content" id="Paper" cols="30" rows="30" class="customInput disabled:bg-gray-100" disabled></textarea>
                        </div>
                    </div>
                </div>
                <!--       متن انگلیسی مقاله-->
                <div class="w-full flex flex-col px-2 mt-3">
                    <label for="Paper" class="customLabel">محتوا (انگلیسی) : </label>
                    <textarea asp-for="PostDto.EnglishContent" id="Paper" cols="30" rows="30" class="customInput disabled:bg-gray-100" disabled></textarea>
                </div>
            </div>
                    <div class="w-full flex px-2">
                        <div class="w-1/2 py-3 pl-3">
                            <a asp-page="Edit" asp-route-Id="@Model.PostDto.Id" class="subBtn btnIndigo">ویرایش</a>
                        </div>
                        <div class="w-1/2 py-3 pr-3">
                            <a asp-page="Index" asp-route-sub="@Model.PostDto.CategoryId" class="subBtn btnDark">
                                بازگشت
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script src="https://cdn.tiny.cloud/1/cee6xecr4p6rcl06y0bfi2a24k8yedskjlphi9wiflw2pw1g/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>

    <script>
                const example_image_upload_handler = (blobInfo, progress) => new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.withCredentials = false;
          xhr.open('POST', '@Url.Action("UploadPaperImage", "Api")');

          xhr.upload.onprogress = (e) => {
            progress(e.loaded / e.total * 100);
          };

          xhr.onload = () => {
            if (xhr.status === 403) {
              reject({ message: 'HTTP Error: ' + xhr.status, remove: true });
              return;
            }

            if (xhr.status < 200 || xhr.status >= 300) {
              reject('HTTP Error: ' + xhr.status);
              return;
            }

            const json = JSON.parse(xhr.responseText);

            if (!json || typeof json.location != 'string') {
              reject('Invalid JSON: ' + xhr.responseText);
              return;
            }

            resolve(json.location);
          };

          xhr.onerror = () => {
            reject('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);
          };

          const formData = new FormData();
          formData.append('file', blobInfo.blob(), blobInfo.filename());

          xhr.send(formData);
        });

        tinymce.init({
          readonly : 1,
          selector: 'textarea',
          language_url: '/Scripts/tinymce/fa.js', // مسیر فایل زبان
          language: 'fa',
          plugins: [
            'link', 'image', 'lists', 'table', 'autolink', 'visualblocks', 'searchreplace'
          ],
          toolbar: 'undo redo | bold italic underline strikethrough | alignleft aligncenter alignright | bullist numlist outdent indent | link image table | removeformat',
          valid_elements: 'img[src|alt|title|width|height],a[href|target],p,b,i,ul,li',
          image_title: true,
          automatic_uploads: true,
          file_picker_types: 'image',
          images_upload_url: '@Url.Action("UploadPaperImage", "Api")', // مسیر برای آپلود تصاویر
          images_upload_handler: example_image_upload_handler
        });
        tinymce.activeEditor.getBody().setAttribute('contenteditable', false);

    </script>
}